---
import { getCollection } from 'astro:content';
import BaseLayout from '../../layouts/BaseLayout.astro';
import Navbar from '../../components/Navbar';

export async function getStaticPaths() {
  const posts = await getCollection('posts');
  return posts.map(post => ({
    params: { slug: post.slug },
    props: { post },
  }));
}

const { post } = Astro.props;
const { Content } = await post.render();
---

<BaseLayout title={post.data.title}>
    <Navbar client:load />

    <div class="content-container pt-28 pb-20">
      <a href="/posts/" id="go-back" class="inline-block mb-8 font-mono text-xs font-bold hover:text-red-600 transition-colors">
        &larr; GO BACK
      </a>

      <script>
        const backLink = document.getElementById('go-back');
        if (backLink) {
            backLink.addEventListener('click', (e) => {
                // 如果有来源页面，且来源页面属于本站，则执行后退
                if (document.referrer && document.referrer.includes(window.location.host)) {
                    e.preventDefault();
                    window.history.back();
                }
            });
        }
      </script>

      <div class="bg-white border-2 border-black p-6 md:p-12 shadow-[8px_8px_0px_#ccc]">
          <article class="prose prose-lg prose-invert max-w-none mx-auto">
            <header class="mb-12 border-b-2 border-black pb-8">
                <div class="flex items-center gap-3 font-mono text-xs font-bold text-gray-500 mb-4">
                    <span class="text-black">{post.data.date}</span>
                    <span class="w-1 h-1 bg-gray-300 rounded-full"></span>
                    <span class="uppercase tracking-wider text-red-600">{post.data.tag || 'GENERAL'}</span>
                </div>
                <h1 class="text-3xl md:text-5xl font-black uppercase tracking-tight mb-6 leading-tight">{post.data.title}</h1>
                {post.data.image && (
                    <div class="w-full bg-gray-100 mt-8 border-2 border-black overflow-hidden relative flex justify-center items-center">
                        <img 
                            src={post.data.image} 
                            alt={post.data.title} 
                            class="max-w-full h-auto max-h-[600px] object-contain"
                        />
                    </div>
                )}
            </header>

            <div class="font-serif leading-relaxed text-lg text-gray-800">
                <Content />
            </div>
          </article>
      </div>
    </div>
</BaseLayout>
